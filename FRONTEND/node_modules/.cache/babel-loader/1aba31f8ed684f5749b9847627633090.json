{"ast":null,"code":"var _jsxFileName = \"/home/saidi/Desktop/TAYLOR+GOODS/frontend/src/templates/ProductTemplate.js\";\nimport React, { useEffect, useReducer, useCallback } from 'react';\nimport styled from 'styled-components';\nimport UserTemplate from 'templates/UserTemplate';\nimport Button from 'components/atoms/Button/Button';\nimport { useSelector, useDispatch } from 'react-redux';\nimport Select from 'react-select';\nimport filtersIcon from \"assets/icons/filters.svg\";\nimport { defaultStyle } from 'components/molecules/AddItemModal/SelectCustom';\nimport 'components/atoms/Input/RangeInput.css';\nimport AsideFilters from 'components/molecules/Filters/AsideFilters';\nimport FiltersContent from 'components/molecules/Filters/FiltersContent';\nimport useSkeleton from 'hooks/useSkeleton';\nimport EmptyState from 'components/molecules/EmptyState/EmptyState';\nimport GridTemplate from 'templates/GridTemplate';\nimport { fetchProducts, setSearchValues, PRODUCT_FETCH_LIMIT } from 'actions';\nimport FiltersProvider from 'context/FiltersContext';\nimport { priceEndP, categoryEndP, sortEndP, searchEndP } from 'helpers/endpoints';\nconst Wrapper = styled.div`\n  display: flex;\n  padding: 20px 0;\n`;\nconst MainWrapper = styled.main`\n  width: 100%;\n  padding-bottom: 50px;\n`;\nconst SideMenu = styled.aside`\n  display: none;\n  flex-basis: 460px;\n  padding-right: 30px;\n  height: 100%;\n  ${({\n  theme\n}) => theme.mq.lg} {\n    display: block;\n  }\n`;\nconst OptionsWrapper = styled.div`\n  display: flex;\n  align-items: center;\n  margin: 0 0 20px;\n`;\nconst SelectWrapper = styled.div`\n  margin-left: auto;\n  width: 190px;\n`;\nconst Filter = styled.button`\n  display: block;\n  background-image: url(${filtersIcon});\n  background-size: 21px;\n  background-position: 10px 50%;\n  background-repeat: no-repeat;\n  padding: 9px 12px 9px 38px;\n  border-radius: 5px;\n  background-color: transparent;\n  border: 1px solid #ddd;\n  cursor: pointer;\n  ${({\n  theme\n}) => theme.mq.lg} {\n    display: none;\n  }\n`;\nconst StyledButton = styled(Button)`\n  width: 220px;\n  margin: 30px auto 0;\n`;\nconst options = [{\n  value: 'featured',\n  label: 'Featured'\n}, {\n  value: 'priceASC',\n  label: 'Price, low to high'\n}, {\n  value: 'priceDESC',\n  label: 'Price, high to low'\n}, {\n  value: 'alphabetASC',\n  label: 'Alphabetically, A-Z'\n}, {\n  value: 'alphabetDESC',\n  label: 'Alphabetically, Z-A'\n}];\n\nconst ProductTemplate = () => {\n  const givenSearchedValue = useSelector(({\n    searchValues\n  }) => searchValues.search);\n  const givenCategories = useSelector(({\n    searchValues\n  }) => searchValues.categories);\n  const allProducts = useSelector(({\n    products\n  }) => products);\n  const isDataFetching = useSelector(({\n    isDataLoading\n  }) => isDataLoading);\n  const dispatchToStore = useDispatch();\n  const initialFilters = {\n    priceRange: {\n      min: 0,\n      max: 150\n    },\n    sortBy: options[0],\n    categories: givenCategories,\n    searchInputValue: givenSearchedValue,\n    areAsideFiltersVisible: false\n  };\n  const [filters, dispatch] = useReducer((state, action) => {\n    switch (action.type) {\n      case 'PRICE':\n        return { ...state,\n          priceRange: action.payload\n        };\n\n      case 'SORT_BY':\n        return { ...state,\n          sortBy: action.payload\n        };\n\n      case 'CATEGORIES':\n        return { ...state,\n          categories: action.payload\n        };\n\n      case 'SEARCH':\n        return { ...state,\n          searchInputValue: action.payload\n        };\n\n      case 'SHOW_ASIDE_FILTERS':\n        return { ...state,\n          areAsideFiltersVisible: true\n        };\n\n      case 'HIDE_ASIDE_FILTERS':\n        return { ...state,\n          areAsideFiltersVisible: false\n        };\n\n      default:\n        return state;\n    }\n  }, initialFilters);\n\n  const applyFilters = (isNew = false) => {\n    if (allProducts.length === 0 && filters.searchInputValue.length >= 3) return;\n    const endpoint = `${categoryEndP(filters.categories) + priceEndP(filters.priceRange) + sortEndP(filters.sortBy.value) + searchEndP(filters.searchInputValue)}`;\n    dispatchToStore(fetchProducts(endpoint, isNew));\n  };\n\n  const clearFilters = useCallback(() => {\n    dispatch({\n      type: 'PRICE',\n      payload: {\n        min: 0,\n        max: 150\n      }\n    });\n    dispatch({\n      type: 'CATEGORIES',\n      payload: []\n    });\n    dispatch({\n      type: 'SORT_BY',\n      payload: options[0]\n    });\n    dispatchToStore(setSearchValues('search', ''));\n    dispatchToStore(setSearchValues('categories', []));\n  }, [dispatchToStore]);\n  useEffect(() => {\n    applyFilters(); // eslint-disable-next-line\n  }, [filters.sortBy, filters.searchInputValue]);\n  useEffect(() => {\n    dispatch({\n      type: 'SEARCH',\n      payload: givenSearchedValue\n    });\n    return () => clearFilters();\n  }, [givenSearchedValue, clearFilters]);\n\n  const includeCategory = categoryName => {\n    if (filters.categories.some(category => category === categoryName)) {\n      const newCategories = filters.categories.filter(category => category !== categoryName);\n      dispatch({\n        type: 'CATEGORIES',\n        payload: newCategories\n      });\n    } else dispatch({\n      type: 'CATEGORIES',\n      payload: [...filters.categories, categoryName]\n    });\n  };\n\n  const handleSearch = e => {\n    dispatch({\n      type: 'SEARCH',\n      payload: e.target.value\n    });\n  };\n\n  const catalogFilters = {\n    priceRange: filters.priceRange,\n    priceHandler: value => dispatch({\n      type: 'PRICE',\n      payload: value\n    }),\n    searchValue: filters.searchInputValue,\n    handleSearch,\n    markedCategories: filters.categories,\n    includeCategory,\n    applyFilters,\n    clearFilters,\n    close: () => dispatch({\n      type: 'HIDE_ASIDE_FILTERS'\n    })\n  };\n  const isSkeletonLoading = useSkeleton();\n  return /*#__PURE__*/React.createElement(UserTemplate, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Wrapper, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(FiltersProvider, {\n    filters: catalogFilters,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(AsideFilters, {\n    isOpen: filters.areAsideFiltersVisible,\n    close: () => dispatch({\n      type: 'HIDE_ASIDE_FILTERS'\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(SideMenu, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(FiltersContent, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 13\n    }\n  }))), /*#__PURE__*/React.createElement(MainWrapper, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(OptionsWrapper, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Filter, {\n    onClick: () => dispatch({\n      type: 'SHOW_ASIDE_FILTERS'\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 13\n    }\n  }, \"Filters\"), /*#__PURE__*/React.createElement(SelectWrapper, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Select, {\n    options: options,\n    styles: defaultStyle,\n    onChange: option => dispatch({\n      type: 'SORT_BY',\n      payload: option\n    }),\n    value: filters.sortBy,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 15\n    }\n  }))), !isDataFetching && !isSkeletonLoading && allProducts.length === 0 && /*#__PURE__*/React.createElement(EmptyState, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 41\n    }\n  }), /*#__PURE__*/React.createElement(GridTemplate, {\n    products: allProducts,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 11\n    }\n  }), !isSkeletonLoading && PRODUCT_FETCH_LIMIT === allProducts.length && /*#__PURE__*/React.createElement(StyledButton, {\n    onClick: () => applyFilters(true),\n    secondary: \"true\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 13\n    }\n  }, \"Load more\"))));\n};\n\nexport default ProductTemplate;","map":{"version":3,"sources":["/home/saidi/Desktop/TAYLOR+GOODS/frontend/src/templates/ProductTemplate.js"],"names":["React","useEffect","useReducer","useCallback","styled","UserTemplate","Button","useSelector","useDispatch","Select","defaultStyle","AsideFilters","FiltersContent","useSkeleton","EmptyState","GridTemplate","fetchProducts","setSearchValues","PRODUCT_FETCH_LIMIT","FiltersProvider","priceEndP","categoryEndP","sortEndP","searchEndP","Wrapper","div","MainWrapper","main","SideMenu","aside","theme","mq","lg","OptionsWrapper","SelectWrapper","Filter","button","filtersIcon","StyledButton","options","value","label","ProductTemplate","givenSearchedValue","searchValues","search","givenCategories","categories","allProducts","products","isDataFetching","isDataLoading","dispatchToStore","initialFilters","priceRange","min","max","sortBy","searchInputValue","areAsideFiltersVisible","filters","dispatch","state","action","type","payload","applyFilters","isNew","length","endpoint","clearFilters","includeCategory","categoryName","some","category","newCategories","filter","handleSearch","e","target","catalogFilters","priceHandler","searchValue","markedCategories","close","isSkeletonLoading","option"],"mappings":"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","sourcesContent":["import React, { useEffect, useReducer, useCallback } from 'react';\nimport styled from 'styled-components';\nimport UserTemplate from 'templates/UserTemplate';\nimport Button from 'components/atoms/Button/Button';\nimport { useSelector, useDispatch } from 'react-redux';\nimport Select from 'react-select';\nimport filtersIcon from 'assets/icons/filters.svg';\nimport { defaultStyle } from 'components/molecules/AddItemModal/SelectCustom';\nimport 'components/atoms/Input/RangeInput.css';\nimport AsideFilters from 'components/molecules/Filters/AsideFilters';\nimport FiltersContent from 'components/molecules/Filters/FiltersContent';\nimport useSkeleton from 'hooks/useSkeleton';\nimport EmptyState from 'components/molecules/EmptyState/EmptyState';\nimport GridTemplate from 'templates/GridTemplate';\nimport { fetchProducts, setSearchValues, PRODUCT_FETCH_LIMIT } from 'actions';\nimport FiltersProvider from 'context/FiltersContext';\nimport {\n  priceEndP,\n  categoryEndP,\n  sortEndP,\n  searchEndP,\n} from 'helpers/endpoints';\n\nconst Wrapper = styled.div`\n  display: flex;\n  padding: 20px 0;\n`;\n\nconst MainWrapper = styled.main`\n  width: 100%;\n  padding-bottom: 50px;\n`;\n\nconst SideMenu = styled.aside`\n  display: none;\n  flex-basis: 460px;\n  padding-right: 30px;\n  height: 100%;\n  ${({ theme }) => theme.mq.lg} {\n    display: block;\n  }\n`;\n\nconst OptionsWrapper = styled.div`\n  display: flex;\n  align-items: center;\n  margin: 0 0 20px;\n`;\n\nconst SelectWrapper = styled.div`\n  margin-left: auto;\n  width: 190px;\n`;\n\nconst Filter = styled.button`\n  display: block;\n  background-image: url(${filtersIcon});\n  background-size: 21px;\n  background-position: 10px 50%;\n  background-repeat: no-repeat;\n  padding: 9px 12px 9px 38px;\n  border-radius: 5px;\n  background-color: transparent;\n  border: 1px solid #ddd;\n  cursor: pointer;\n  ${({ theme }) => theme.mq.lg} {\n    display: none;\n  }\n`;\n\nconst StyledButton = styled(Button)`\n  width: 220px;\n  margin: 30px auto 0;\n`;\n\nconst options = [\n  { value: 'featured', label: 'Featured' },\n  { value: 'priceASC', label: 'Price, low to high' },\n  { value: 'priceDESC', label: 'Price, high to low' },\n  { value: 'alphabetASC', label: 'Alphabetically, A-Z' },\n  { value: 'alphabetDESC', label: 'Alphabetically, Z-A' },\n];\n\nconst ProductTemplate = () => {\n  const givenSearchedValue = useSelector(\n    ({ searchValues }) => searchValues.search,\n  );\n  const givenCategories = useSelector(\n    ({ searchValues }) => searchValues.categories,\n  );\n\n  const allProducts = useSelector(({ products }) => products);\n  const isDataFetching = useSelector(({ isDataLoading }) => isDataLoading);\n  const dispatchToStore = useDispatch();\n\n  const initialFilters = {\n    priceRange: { min: 0, max: 150 },\n    sortBy: options[0],\n    categories: givenCategories,\n    searchInputValue: givenSearchedValue,\n    areAsideFiltersVisible: false,\n  };\n\n  const [filters, dispatch] = useReducer((state, action) => {\n    switch (action.type) {\n      case 'PRICE':\n        return {\n          ...state,\n          priceRange: action.payload,\n        };\n      case 'SORT_BY':\n        return {\n          ...state,\n          sortBy: action.payload,\n        };\n      case 'CATEGORIES':\n        return {\n          ...state,\n          categories: action.payload,\n        };\n      case 'SEARCH':\n        return {\n          ...state,\n          searchInputValue: action.payload,\n        };\n      case 'SHOW_ASIDE_FILTERS':\n        return {\n          ...state,\n          areAsideFiltersVisible: true,\n        };\n      case 'HIDE_ASIDE_FILTERS':\n        return {\n          ...state,\n          areAsideFiltersVisible: false,\n        };\n      default:\n        return state;\n    }\n  }, initialFilters);\n\n  const applyFilters = (isNew = false) => {\n    if (allProducts.length === 0 && filters.searchInputValue.length >= 3)\n      return;\n    const endpoint = `${\n      categoryEndP(filters.categories) +\n      priceEndP(filters.priceRange) +\n      sortEndP(filters.sortBy.value) +\n      searchEndP(filters.searchInputValue)\n    }`;\n\n    dispatchToStore(fetchProducts(endpoint, isNew));\n  };\n\n  const clearFilters = useCallback(() => {\n    dispatch({ type: 'PRICE', payload: { min: 0, max: 150 } });\n    dispatch({ type: 'CATEGORIES', payload: [] });\n    dispatch({ type: 'SORT_BY', payload: options[0] });\n    dispatchToStore(setSearchValues('search', ''));\n    dispatchToStore(setSearchValues('categories', []));\n  }, [dispatchToStore]);\n\n  useEffect(() => {\n    applyFilters();\n    // eslint-disable-next-line\n  }, [filters.sortBy, filters.searchInputValue]);\n\n  useEffect(() => {\n    dispatch({ type: 'SEARCH', payload: givenSearchedValue });\n\n    return () => clearFilters();\n  }, [givenSearchedValue, clearFilters]);\n\n  const includeCategory = categoryName => {\n    if (filters.categories.some(category => category === categoryName)) {\n      const newCategories = filters.categories.filter(\n        category => category !== categoryName,\n      );\n      dispatch({ type: 'CATEGORIES', payload: newCategories });\n    } else\n      dispatch({\n        type: 'CATEGORIES',\n        payload: [...filters.categories, categoryName],\n      });\n  };\n\n  const handleSearch = e => {\n    dispatch({ type: 'SEARCH', payload: e.target.value });\n  };\n\n  const catalogFilters = {\n    priceRange: filters.priceRange,\n    priceHandler: value => dispatch({ type: 'PRICE', payload: value }),\n    searchValue: filters.searchInputValue,\n    handleSearch,\n    markedCategories: filters.categories,\n    includeCategory,\n    applyFilters,\n    clearFilters,\n    close: () => dispatch({ type: 'HIDE_ASIDE_FILTERS' }),\n  };\n\n  const isSkeletonLoading = useSkeleton();\n\n  return (\n    <UserTemplate>\n      <Wrapper>\n        <FiltersProvider filters={catalogFilters}>\n          <AsideFilters\n            isOpen={filters.areAsideFiltersVisible}\n            close={() => dispatch({ type: 'HIDE_ASIDE_FILTERS' })}\n          />\n          <SideMenu>\n            <FiltersContent />\n          </SideMenu>\n        </FiltersProvider>\n        <MainWrapper>\n          <OptionsWrapper>\n            <Filter onClick={() => dispatch({ type: 'SHOW_ASIDE_FILTERS' })}>\n              Filters\n            </Filter>\n            <SelectWrapper>\n              <Select\n                options={options}\n                styles={defaultStyle}\n                onChange={option =>\n                  dispatch({ type: 'SORT_BY', payload: option })\n                }\n                value={filters.sortBy}\n              />\n            </SelectWrapper>\n          </OptionsWrapper>\n          {!isDataFetching &&\n            !isSkeletonLoading &&\n            allProducts.length === 0 && <EmptyState />}\n          <GridTemplate products={allProducts} />\n          {!isSkeletonLoading && PRODUCT_FETCH_LIMIT === allProducts.length && (\n            <StyledButton onClick={() => applyFilters(true)} secondary=\"true\">\n              Load more\n            </StyledButton>\n          )}\n        </MainWrapper>\n      </Wrapper>\n    </UserTemplate>\n  );\n};\n\nexport default ProductTemplate;\n"]},"metadata":{},"sourceType":"module"}